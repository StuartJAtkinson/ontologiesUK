# 2021 - Week 17

## Logical procedure mapping

Librarian Jayne and [Michael](https://twitter.com/fantasticlife) had a fairly typical week, shouting random letters at one another as they set about checking the [data for the newly logical made affirmative procedure](https://ukparliament.github.io/ontologies/procedure/flowcharts/sis/logic-gates/made-affirmative.pdf). With only occasional bursts of swearing. And even then, only mild. Several hours of squinting turned up a single route entered in error. Which, for a procedure with [1,231 routes](https://ukparliament.github.io/ontologies/meta/weeknotes/2021/16/machine-made-affirmative.pdf) is not too shabby. Not too shabby at all.

Made affirmative [checked](https://trello.com/c/q8GTsEJa/22-enter-made-affirmative-routes-to-staging), we now have all statutory instrument procedures remapped, with data entered and verified. Which means the next stop is the [hot mess that makes up the map for treaties](https://ukparliament.github.io/ontologies/procedure/flowcharts/crag-treaties/crag-treaties.pdf) laid under the [Constitutional Reform and Governance Act 2010](https://www.legislation.gov.uk/ukpga/2010/25/contents). This made slightly easier by our late dawning realisation that we'd designed a model for [componentised procedures](https://ukparliament.github.io/ontologies/procedure/procedure-ontology.html#d4e369). And promptly forgotten about it. Lords' committees - defunct since the arrival of the [International Agreements Committee](https://committees.parliament.uk/committee/448/international-agreements-committee/), but still present in our data - [have been mapped](https://github.com/ukparliament/ontologies/blob/master/procedure/flowcharts/components/crag-treaty-lords-eu-committee/crag-treaty-lords-eu-committee.pdf). More [data has been added](https://ukparliament.github.io/ontologies/meta/weeknotes/2021/17/machine-lords-eu-committes.pdf). And, as ever, [more checking](https://trello.com/c/Jao1oZtH/18-remap-crag-treaty) needs to happen.

## Parsing procedure maps

[Last week](https://ukparliament.github.io/ontologies/meta/weeknotes/2021/16/) we mentioned that young Robert and Michael had been hard at work refactoring and commenting our [procedure parsing code](https://github.com/ukparliament/procedure-parsing). And that we had a suspicion that the whole thing would run much faster with far fewer queries. The act of parsing a route requires knowledge of the status of inbound routes to the source step of the route being parsed. And, having parsed a route, another query was triggered to get outbound routes from the target step of the route just parsed. All of which was rather expensive with the cost growing in proportion to the number of routes in the procedure. [n+1](https://www.brentozar.com/archive/2018/07/common-entity-framework-problems-n-1) being never nice. All of this led to a [work package](https://ukparliament.github.io/ontologies/procedure/procedure-ontology.html#d4e222) subject to the [made negative procedure](https://ukparliament.github.io/ontologies/procedure/flowcharts/sis/logic-gates/made-negative.pdf) taking over 15 seconds to parse. Robert and Michael both felt things would be much improved if they could run a couple of queries up front and wrangle the whole thing into a roughly graph shaped data structure. But neither had a clue how to do it. The revelation came when Michael called an early night and had one of his all too rare, dairy product powered brainwaves. Which means we now have a handful of queries running at the start of the request and four hashes: one to [store the routes](https://github.com/ukparliament/procedure-parsing/blob/master/lib/parsing/route_hash.rb) and their parsing status, one to [store the steps](https://github.com/ukparliament/procedure-parsing/blob/master/lib/parsing/step_hash.rb#L46), one to [store routes to a step](https://github.com/ukparliament/procedure-parsing/blob/master/lib/parsing/step_hash.rb#L43) and one to [store routes from a step](https://github.com/ukparliament/procedure-parsing/blob/master/lib/parsing/step_hash.rb#L40). The made negative procedure now parses in roughly two seconds. Which is still probably one second more than it would ideally take. But a time span that we assume won't increase too much should the procedure grow. As procedures tend to do. The code is in a number of pieces and needs a [proper refactor](https://trello.com/c/BEww0rPg/127-rewrite-the-parsing-code-to-work-in-memory). And yet more comments. More work for next week.

## On the nature of eggs and the essence of their timing

With the end of the current session upon us and a whole new session to look forward to, Robert and Michael made a few tweaks to our beloved [egg timer](https://parliament-calendar.herokuapp.com/) to [close off the old session](https://parliament-calendar.herokuapp.com/sessions/2) and [start off the new](https://parliament-calendar.herokuapp.com/sessions/1). Previously written instructions were widely ignored as a new, more efficient method was found. And [promptly](https://trello.com/c/6tlwT7SM/126-rewrite-instructions-for-what-to-do-at-dissolution-for-egg-timer) [written up](https://parliament-calendar.herokuapp.com/meta/prorogation-and-dissolution).

They also took the opportunity to add a calculation for the brand spanking new [published drafts under the European Union (Withdrawal) Act 2018](https://parliament-calendar.herokuapp.com/calculator/calculate?procedure=12&start-date=2021-05-01&day-count=28). As ever, [comments citing legislation](https://github.com/fantasticlife/egg-timer/blob/master/app/controllers/calculator_controller.rb#L125) were added as [Markdown](https://en.wikipedia.org/wiki/Markdown) and [parsed into HTML](https://parliament-calendar.herokuapp.com/bicameral_both_houses_sitting.rb.html). It is important to show one's working.

## A new procedure this way comes?

On the subject of [paragraph 14 of schedule 8 of the European Union (Withdrawal) Act 2018](https://www.legislation.gov.uk/ukpga/2018/16/schedule/8/enacted#schedule-8-paragraph-14), Jayne and Michael have made a [small start](https://trello.com/c/enshaWLT/9-map-the-procedure-route-types) on mapping the [teeniest of tiniest procedures](https://github.com/ukparliament/ontologies/blob/master/procedure/flowcharts/published-drafts-under-euwa/published-drafts-under-euwa.pdf). For now just using [route types](https://trello.com/c/enshaWLT/9-map-the-procedure-route-types); a more [logical model](https://trello.com/c/pkO6NJJ2/10-map-the-procedure-step-types) to follow. A number of things are still unclear, not least whether such things can be withdrawn and, if so, how that might happen. But at least we have a straw man to poke at.

## Sessional tweeturns

End of session also brought a flurry of tweets from our [SI](https://twitter.com/madenlaid/status/1388115553869602816) and [tweaty tracking](https://twitter.com/TweatyTwacker/status/1388128572397735949) Twitter bots. Or at least from the team of crack librarians that sit behind them. Credit to [Anya](https://twitter.com/bitten_) for the original idea and her determination to prove that [Sessional Returns](https://www.parliament.uk/business/publications/commons/sessional-returns/) would ideally be be formed from a set of reusable, repurpose-able [queries](https://ukparliament.github.io/ontologies/procedure/meta/queries/). And why not, we all say.

## Kind hearts / coronets

Librarian Ned joined Robert and Michael to make a start on a more ontological model for peerages based on everything we've learned from [David](https://twitter.com/clerkly) and Grant. For now, it's [just a picture](https://github.com/ukparliament/ontologies/blob/master/peerage/peerage.png). And will probably change. They're hoping to make a start on transforming pixels to [Turtle](https://en.wikipedia.org/wiki/Turtle_(syntax)) next week, though comments might take a wee while longer.

## Electioneering

Anya, Robert, Michael and open data boss bloke Ian all met with [Oli](https://twitter.com/olihawkins) to chat through his general election database and the assorted work and data flows that surround it. Which, at least for the lower House and for around two weeks every fours years, is pretty much all the data flows. Oli has sent over the schema set up files and Anya, Robert and Michael have been pouring over them and working out how they fit with our own [election model](https://ukparliament.github.io/ontologies/election/election-ontology.html). They've also started to add a few bits and bobs to our more [relational efforts](https://ukparliament.github.io/ontologies/meta/relational/). Though, for now, only in [picture format](https://ukparliament.github.io/ontologies/meta/relational/schema.png).



