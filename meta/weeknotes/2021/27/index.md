# 2021 - Week 27

## CRaG complications

[Last week's notes](https://ukparliament.github.io/ontologies/meta/weeknotes/2021/26/) struck a tone of triumph. Our crack team of librarians and computational experts being under the happy illusion that they'd finally cracked our [CRaG](https://www.legislation.gov.uk/ukpga/2010/25/contents) based conundrums. Joy was unconfined but not set to last. Around the time [Michael](https://twitter.com/fantasticlife) pressed publish - or just before, if we're going to be totally honest - he realised that we'd fail to take account of Section 20, paragraphs [7](https://www.legislation.gov.uk/ukpga/2010/25/section/20#section-20-7) and [8](https://www.legislation.gov.uk/ukpga/2010/25/section/20#section-20-8). Once more snatching defeat from the jaws of victory.

We had been under the impression that - should the House of Commons not approve a motion that the treaty should not be ratified in [period A](https://www.legislation.gov.uk/ukpga/2010/25/section/20#section-20-2) and the House of Lords did approve such a motion - a ministerial statement that the 'treaty should nonetheless be ratified' would send us tumbling into the first of a potentially infinte set of [period Bs](https://www.legislation.gov.uk/ukpga/2010/25/section/20#section-20-5). Sadly, this is not the case. Should the Lords resolve against ratification and the Commons not, a ministerial statement is all it takes to make ratification possible. This simplifies everything considerably. For some definitions of 'everything' and 'considerably'.

All of which led to Librarian Jayne and Michael spending more time in the brain melting mess of a map that is the 'simplified' CRaG treaty procedure. They now have a [new version of the map](https://ukparliament.github.io/ontologies/procedure/flowcharts/crag-treaties/logic-gates/redux/redux.pdf) and a [new version of its plain text equivalent](https://ukparliament.github.io/ontologies/procedure/flowcharts/crag-treaties/logic-gates/redux/) and have declared themselves happy. Some of the [simpler parts](https://trello.com/c/bCq9iuBR/131-remap-treaties) around the tabling, debating and moving of motions in the Lords have even been decanted into the [logical treaty map proper](https://ukparliament.github.io/ontologies/procedure/flowcharts/crag-treaties/logic-gates/crag-treaties.pdf). Comments, clarifications and corrections from confirmed CRaGheads, all more than welcome. We expect our [Rules as Code](https://oecd-opsi.org/projects/rulesascode/) badges are already in the post.

## Parsing the procedure maps

In the course of CRaG mapping, we've managed to invent four new step types: a [sum step](https://api.parliament.uk/procedures/comments/sum_step.rb.html), an [increment step](https://api.parliament.uk/procedures/comments/increment_step.rb.html), an [equals step](https://api.parliament.uk/procedures/comments/equals_step.rb.html) and a signpost step. Since our new widgets seem fairly stable, Michael has spent a small part of the week adapting [our parsing code](https://api.parliament.uk/procedures/meta/comments) to cope with the first three. A job made much easier by the code being nicely modularised. Thanks young Robert. Thanks younger Michael.

Code for the [parsing of signpost steps](https://trello.com/c/ALIjQdvs/145-add-code-to-parse-routes-from-signpost-steps) is currently in pieces on the floor of Michael's machine. But it should be trivial because they don't really do anything. They were invented in the course of our mapping, to wrap up sets of arithmetic and logical operators into one reusable package. The take a single input from a chain of preceding steps, decorate them with a comment to say 'if the input to this is true, this comment is also true' and spit out the all the attributes of the inbound route into one or more outbound routes. Which means - once we've worked out the logic - we can reuse it from any other part part of the map. Lovely.

## On the nature of time and the timing of eggs

Our regular reader will know we're incredibly proud of our wee [egg timer](https://parliament-calendar.herokuapp.com/). It takes assorted bits of legislation pertaining to the scrutiny periods for assorted types of instrument and [renders them as code](https://parliament-calendar.herokuapp.com/meta/comments). Allowing clerkly colleagues to select a procedure, set a start date, choose the number of days to count and get rewarded with an answer. Now all this is fine but ...

... for some flavours of instrument there is a defined number of days to count. Others have a typical number of days but come with caveats. And the number of countable days for our blessed [made affirmatives](https://ukparliament.github.io/ontologies/procedure/flowcharts/sis/logic-gates/made-affirmative.pdf) is impossible to predict without reference to the enabling legislation. Over the course of some pints with [Anya](https://twitter.com/bitten_) and Michael, [Matt](https://twitter.com/MattKorris) expressed his delight with the egg timer. How could he do other? But he did suggest that - for procedures where the day count was set in stone - it was a bit rubbish to present users with a blank text box. So there is now new code. For the set in stone flavours, the day count box is now pre-populated. For procedures with typical day counts and caveats, the day count box is pre-populated with a warning that it may be well be wrong. And for procedures with no typical day count, the box remains empty with a handy link to our [user guide](https://parliament-calendar.herokuapp.com/meta/using). Which is better than nothing.

## A new procedure this way comes

On Tuesday, we were delighted to welcome back JO Jane as she returned from her short vacation. The published draft map was dragged back out and [picked over](https://trello.com/c/F1etoEdn/26-edits-to-procedure-maps-from-jw) with her usual fine toothcomb. As the result, what had been an optional ministerial statement in the Lords, has now been removed from the [route type map](https://ukparliament.github.io/ontologies/procedure/flowcharts/published-drafts-under-euwa/published-drafts-under-euwa.pdf), the [logical map](https://ukparliament.github.io/ontologies/procedure/flowcharts/published-drafts-under-euwa/logic-gates/published-drafts-under-euwa.pdf) and the data. We await a couple of website tweaks and all will be revealed.


