# Some handy [SPARQL](https://en.wikipedia.org/wiki/SPARQL) queries

Given [accurate maps of procedures](https://ukparliament.github.io/ontologies/procedure/procedure-ontology.html#flowcharts) and enough instance data of things subject to those procedures, we can start to treat precedence as a thing we can query for.

This is a list of SPARQL queries used by the House of Commons Library to check and report on their work. Feedback and requests always welcome. Please email [RIIDMSMailbox@parliament.uk](mailto:RIIDMSMailbox@parliament.uk).

## Query to generate a CSV of procedure step descriptions

We used to maintain a separate spreadsheet of [procedure steps](https://ukparliament.github.io/ontologies/procedure/procedure-ontology.html#d4e175) with scope notes, links notes and information around how to select a date for a [business item](https://ukparliament.github.io/ontologies/procedure/procedure-ontology.html#d4e248). This information is now in the data platform so we can generate the same spreadsheet but from live data:

* [Procedure step information](https://api.parliament.uk/sparql#query=PREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0APREFIX+%3A+%3Chttps%3A%2F%2Fid.parliament.uk%2Fschema%2F%3E%0Aselect+%3FProcedurestep+%3FprocedureStepName+%3Fscope+%3Fdate+%3Flink+%3Flegislaturename+where+%7B%3FProcedurestep+a+%3AProcedureStep+.%3FProcedurestep+rdfs%3Alabel+%3FprocedureStepName+.OPTIONAL%7B+%3FProcedurestep+%3AprocedureStepScopeNote+%3Fscope+%7D+.OPTIONAL+%7B+%3FProcedurestep+%3AprocedureStepDateNote+%3Fdate+%7D.OPTIONAL+%7B%3FProcedurestep+%3AprocedureStepLinkNote+%3Flink+%7D.OPTIONAL+%7B%3FProcedurestep+%3AprocedureStepHasHouse+%3Flegislature+.%3Flegislature+rdfs%3Alabel+%3Flegislaturename%7D++%7D&contentTypeConstruct=text%2Fturtle&contentTypeSelect=application%2Fsparql-results%2Bjson&endpoint=https%3A%2F%2Fapi.parliament.uk%2Fsparql&requestMethod=POST&tabTitle=Query+1&headers=%7B%7D&outputFormat=table)

## Queries for statutory instruments

The following queries will show all statutory instruments available in the Statutory Instrument Service. This data goes back to the beginning of the 2017-19 session.

* [Statutory instruments](ukparliament.github.io/ontologies/procedure/meta/queries/statutory-instruments)

## Queries for 'currentness'

These three queries will help you establish which [work packages](https://ukparliament.github.io/ontologies/procedure/procedure-ontology.html#d4e259) have reached their end date. We run them to check when we need to [actualise](https://ukparliament.github.io/ontologies/procedure/procedure-ontology.html#d4e358) end steps, where actualising an end step removes the work package from the list of current work packages. 

The query will return all work packages without actualised end steps. Librarians use this query to look for work packages reaching the end of their objection period on any given date or time period. The results will show all current work packages and the date field can be filtered chronologically or you can use the search bar to look for a specific date.  Alternatively you can add an additional string to your query to search by specific date (note you have to add +1 to your date):
 
FILTER ( str(?itemDate) <= '2020-02-06')
 
* [Negative SIs](https://api.parliament.uk/sparql#query=PREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0APREFIX+%3A+%3Chttps%3A%2F%2Fid.parliament.uk%2Fschema%2F%3E%0Aselect+%3FSI+%3FSIname+%3FworkPackage+%3Fproc+%3FprocStepName+%3FitemDate+where+%7B%0A+%3FSI+a+%3AStatutoryInstrumentPaper+.++%0A+++++%3FSI+rdfs%3Alabel+%3FSIname+.%0A%09%3FSI+%3AworkPackagedThingHasWorkPackage+%3FworkPackage+.%0A++%09%3FworkPackage+%3AworkPackageHasProcedure%2Frdfs%3Alabel+%3Fproc%0A++FILTER(%3Fproc+IN+(%22Made+negative%22%2C+%22Draft+negative%22))%0A++%3FworkPackage+%3AworkPackageHasBusinessItem%2F%3AbusinessItemHasProcedureStep+%3FprocStep+%3B%0A+++++++++++%3AworkPackageHasBusinessItem+%3FbusItem+.%0A++%3FbusItem+%3AbusinessItemHasProcedureStep%2Frdfs%3Alabel+%3FitemDate2%3B%0A+++++++++++%3AbusinessItemDate+%3FitemDate+.%0A++%3FprocStep+rdfs%3Alabel+%3FprocStepName.%0A++MINUS%7B%3FworkPackage+%3AworkPackageHasBusinessItem%2F%3AbusinessItemHasProcedureStep+%3FprocStep2+%3B%0A+++++++++++%3AworkPackageHasBusinessItem+%3FbusItem2+.%0A++%3FbusItem2+%3AbusinessItemHasProcedureStep%2Frdfs%3Alabel+%3FitemDate3%3B%0A+++++++++++%3AbusinessItemDate+%3FitemDate1+.%0A++++%3FprocStep2+rdfs%3Alabel+%3FprocStepName2+.+%0A++FILTER(%3FprocStepName2+IN+(%22Procedure+concluded+in+the+House+of+Commons+and+the+House+of+Lords%22%2C+%22Procedure+concluded+in+the+House+of+Commons%22))%0A++++FILTER(%3FitemDate3+IN+(%22Procedure+concluded+in+the+House+of+Commons+and+the+House+of+Lords%22%2C+%22Procedure+concluded+in+the+House+of+Commons%22))%0A++++%0A++%7D%0A++FILTER(%3FprocStepName+IN+(%22Objection+period+ends%22))%0A++FILTER(%3FitemDate2+IN+(%22Objection+period+ends%22))%0A++%0A+++%0A%7D%0A&contentTypeConstruct=text%2Fturtle&contentTypeSelect=application%2Fsparql-results%2Bjson&endpoint=https%3A%2F%2Fapi.parliament.uk%2Fsparql&requestMethod=POST&tabTitle=Negative+-+objection+period+end&headers=%7B%7D&outputFormat=table)
 
* [Made affirmative SIs](https://api.parliament.uk/sparql#query=PREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0APREFIX+%3A+%3Chttps%3A%2F%2Fid.parliament.uk%2Fschema%2F%3E%0Aselect+%3FSI+%3FSIname+%3FworkPackage+%3Fproc+%3FprocStepName+%3FitemDate+where+%7B%0A+%3FSI+a+%3AStatutoryInstrumentPaper+.++%0A+++++%3FSI+rdfs%3Alabel+%3FSIname+.%0A%09%3FSI+%3AworkPackagedThingHasWorkPackage+%3FworkPackage+.%0A++%09%3FworkPackage+%3AworkPackageHasProcedure%2Frdfs%3Alabel+%3Fproc%0A++FILTER(%3Fproc+IN+(%22Made+affirmative%22))%0A++%3FworkPackage+%3AworkPackageHasBusinessItem%2F%3AbusinessItemHasProcedureStep+%3FprocStep+%3B%0A+++++++++++%3AworkPackageHasBusinessItem+%3FbusItem+.%0A++%3FbusItem+%3AbusinessItemHasProcedureStep%2Frdfs%3Alabel+%3FitemDate2%3B%0A+++++++++++%3AbusinessItemDate+%3FitemDate+.%0A++%3FprocStep+rdfs%3Alabel+%3FprocStepName.%0A++MINUS%7B%3FworkPackage+%3AworkPackageHasBusinessItem%2F%3AbusinessItemHasProcedureStep+%3FprocStep2+%3B%0A+++++++++++%3AworkPackageHasBusinessItem+%3FbusItem2+.%0A++%3FbusItem2+%3AbusinessItemHasProcedureStep%2Frdfs%3Alabel+%3FitemDate3%3B%0A+++++++++++%3AbusinessItemDate+%3FitemDate1+.%0A++++%3FprocStep2+rdfs%3Alabel+%3FprocStepName2+.+%0A++FILTER(%3FprocStepName2+IN+(%22Procedure+concluded+in+the+House+of+Commons+and+the+House+of+Lords%22%2C+%22Procedure+concluded+in+the+House+of+Commons%22))%0A++++FILTER(%3FitemDate3+IN+(%22Procedure+concluded+in+the+House+of+Commons+and+the+House+of+Lords%22%2C+%22Procedure+concluded+in+the+House+of+Commons%22))%0A++++%0A++%7D%0A++FILTER(%3FprocStepName+IN+(%22Approval+period+ends%22))%0A++FILTER(%3FitemDate2+IN+(%22Approval+period+ends%22))%0A++%0A+++%0A%7D%0A&contentTypeConstruct=text%2Fturtle&contentTypeSelect=application%2Fsparql-results%2Bjson&endpoint=https%3A%2F%2Fapi.parliament.uk%2Fsparql&requestMethod=POST&tabTitle=Query&headers=%7B%7D&outputFormat=table)
 
* [Treaties](https://api.parliament.uk/sparql#query=PREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0APREFIX+%3A+%3Chttps%3A%2F%2Fid.parliament.uk%2Fschema%2F%3E%0Aselect+%3FTreaty+%3FTreatyname+%3FLeadOrg+%3FSeriesmembership+%3FworkPackage+%3FprocStepName+%3FitemDate+where+%7B%0A+%3FTreaty+a+%3ATreaty+.++%0A+++++%3FTreaty+rdfs%3Alabel+%3FTreatyname+.%0A++OPTIONAL%7B+%3FTreaty+%3AtreatyHasLeadGovernmentOrganisation%2F+rdfs%3Alabel+%3FLeadOrg+.%7D+%0A++OPTIONAL+%7B%3FTreaty+%3AtreatyHasSeriesMembership%2F+%3AseriesItemCitation+%3FSeriesmembership.%7D%0A%09%3FTreaty+%3AworkPackagedThingHasWorkPackage+%3FworkPackage+.%0A++%09%3FworkPackage+%3AworkPackageHasProcedure%2Frdfs%3Alabel+%3Fproc%0A++FILTER(%3Fproc+IN+(%22Treaties+subject+to+the+Constitutional+Reform+and+Governance+Act+2010%22))%0A++%3FworkPackage+%3AworkPackageHasBusinessItem%2F%3AbusinessItemHasProcedureStep+%3FprocStep+%3B%0A+++++++++++%3AworkPackageHasBusinessItem+%3FbusItem+.%0A++%3FbusItem+%3AbusinessItemHasProcedureStep%2Frdfs%3Alabel+%3FitemDate2%3B%0A+++++++++++%3AbusinessItemDate+%3FitemDate+.%0A++%3FprocStep+rdfs%3Alabel+%3FprocStepName.%0A+++MINUS%7B%3FworkPackage+%3AworkPackageHasBusinessItem%2F%3AbusinessItemHasProcedureStep+%3FprocStep2+%3B%0A+++++++++++%3AworkPackageHasBusinessItem+%3FbusItem2+.%0A++%3FbusItem2+%3AbusinessItemHasProcedureStep%2Frdfs%3Alabel+%3FitemDate3%3B%0A+++++++++++%3AbusinessItemDate+%3FitemDate1+.%0A++++%3FprocStep2+rdfs%3Alabel+%3FprocStepName2+.+%0A++++FILTER(%3FprocStepName2+IN+(%22Parliamentary+procedure+concluded%2C+government+cannot+ratify+treaty%22%2C+%22Parliamentary+procedure+concluded%2C+government+can+ratify+treaty%22))%0A++++FILTER(%3FitemDate3+IN+(%22Parliamentary+procedure+concluded%2C+government+cannot+ratify+treaty%22%2C+%22Parliamentary+procedure+concluded%2C+government+can+ratify+treaty%22))++%0A++%7D%0A++FILTER(%3FprocStepName+IN+(%22Objection+period+A+ends%22))%0A++FILTER(%3FitemDate2+IN+(%22Objection+period+A+ends%22))%0A+++%7D%0A&contentTypeConstruct=text%2Fturtle&contentTypeSelect=application%2Fsparql-results%2Bjson&endpoint=https%3A%2F%2Fapi.parliament.uk%2Fsparql&requestMethod=POST&tabTitle=Query&headers=%7B%7D&outputFormat=table)

## Proposed Negative SIs and their following SIs

Proposed Negative Statutory Instuments are laid before Parliament where a decision is taken on whether they can be laid under the negative procedure or must be laid under an affirmative procedure. This query shows all PNSIs and the following SIs with the procedure the following SI was subject to:

* [PNSI and following SIs with procedure](https://api.parliament.uk/sparql#query=PREFIX+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0APREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0APREFIX+%3A+%3Chttps%3A%2F%2Fid.parliament.uk%2Fschema%2F%3E%0ASELECT+*++WHERE+%7B%0A%0A++%3FproposedInstrument+%3Aname+%3Fname.%0A++%3FproposedInstrument+%3AlaidThingHasLaying%2F%3AlayingHasLayingBody%2F%3Aname+%3FlayingBodyName.%0A++++%3FproposedInstrument+%3AproposedNegativeStatutoryInstrumentPaperPrecedesStatutoryInstrumentPaper+%3Fsi.%0A+++%3Fsi+%3AworkPackagedThingHasWorkPackage+%3Fworkpackage.%0A++%3Fsi+%3Aname+%3FSIname.%0A++%3Fworkpackage+%3AworkPackageHasProcedure+%3Fprocedure.%0A++%3Fprocedure+%3Aname+%3FprocedureName.%0A++%0A%7D+%0AGROUP+BY+%3FproposedInstrument+%3Fname+%3FlayingBodyName+%3Fsi+%3FSIname+%3Fworkpackage+%3Fprocedure+%3FprocedureName+&contentTypeConstruct=text%2Fturtle&contentTypeSelect=application%2Fsparql-results%2Bjson&endpoint=https%3A%2F%2Fapi.parliament.uk%2Fsparql&requestMethod=POST&tabTitle=PNSIs+with+followed+SIs&headers=%7B%7D&outputFormat=table)